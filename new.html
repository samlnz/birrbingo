<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .page {
            display: none;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Page 1 - Card Selection */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffeb3b;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .countdown-timer {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            margin-bottom: 25px;
            border: 2px solid #ffeb3b;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .timer-text {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #ffeb3b;
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff4081;
            text-shadow: 0 0 10px rgba(255, 64, 129, 0.7);
        }

        .selection-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .selection-info h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .selected-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .selected-card {
            background: #ff4081;
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
        }

        .card-number {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card-number:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .card-number.selected {
            background: #4caf50;
            border-color: #81c784;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .card-number.disabled {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        .btn-primary:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.6);
        }

        /* Page 2 - Game Page */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            min-width: 250px;
        }

        .player-info h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .player-username {
            font-weight: bold;
            color: #ffeb3b;
            font-size: 1.3rem;
        }

        .caller-display {
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 3px solid #ff4081;
            box-shadow: 0 0 30px rgba(255, 64, 129, 0.4);
        }

        .caller-display h2 {
            color: #ffeb3b;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .current-number {
            font-size: 6rem;
            font-weight: bold;
            color: #ff4081;
            text-shadow: 0 0 20px rgba(255, 64, 129, 0.7);
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .called-numbers-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .called-numbers-container h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .called-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .called-number {
            background: #ff9800;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .player-cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .card-container h3 {
            text-align: center;
            color: #ffeb3b;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .bingo-card {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .bingo-card th {
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: white;
            height: 50px;
            font-size: 1.8rem;
            text-transform: uppercase;
        }

        .bingo-card td {
            width: 20%;
            height: 70px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bingo-card td:hover {
            background-color: #f0f0f0;
        }

        .bingo-card td.marked {
            background-color: #4caf50;
            color: white;
            position: relative;
        }

        .bingo-card td.marked::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: white;
        }

        .bingo-card td.free {
            background-color: #ff9800;
            color: white;
            font-size: 1.2rem;
        }

        .bingo-button-container {
            text-align: center;
            margin-top: 30px;
        }

        .btn-bingo {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            padding: 20px 60px;
            font-size: 2rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.5);
            animation: bingoPulse 2s infinite;
        }

        @keyframes bingoPulse {
            0% { box-shadow: 0 8px 25px rgba(244, 67, 54, 0.5); }
            50% { box-shadow: 0 8px 35px rgba(244, 67, 54, 0.8); }
            100% { box-shadow: 0 8px 25px rgba(244, 67, 54, 0.5); }
        }

        .btn-bingo:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(244, 67, 54, 0.8);
        }

        .btn-bingo:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            animation: none;
            box-shadow: none;
        }

        /* Page 3 - Winner Announcement */
        .winner-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 40px;
            margin-top: 50px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 5px solid #ffeb3b;
        }

        .winner-container h1 {
            color: #ffeb3b;
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .winner-trophy {
            font-size: 8rem;
            color: #ffeb3b;
            margin-bottom: 30px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .winner-name {
            font-size: 3.5rem;
            color: #4fc3f7;
            margin-bottom: 30px;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
        }

        .winner-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-top: 40px;
            text-align: left;
        }

        .winner-card h3 {
            color: #ffeb3b;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .winner-card-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .winner-card-item {
            flex: 1;
            min-width: 200px;
        }

        .winner-card-item p {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .winner-card-item span {
            color: #4fc3f7;
            font-weight: bold;
        }

        .action-buttons-page3 {
            margin-top: 50px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .current-number {
                font-size: 4rem;
                height: 100px;
            }
            
            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }
            
            .card-number {
                height: 70px;
                font-size: 1.3rem;
            }
            
            .bingo-card th {
                font-size: 1.5rem;
                height: 40px;
            }
            
            .bingo-card td {
                height: 60px;
                font-size: 1.3rem;
            }
            
            .winner-container h1 {
                font-size: 2.2rem;
            }
            
            .winner-name {
                font-size: 2.5rem;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1.1rem;
            }
            
            .btn-bingo {
                padding: 15px 40px;
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
            
            .card-number {
                height: 60px;
                font-size: 1.1rem;
            }
            
            .current-number {
                font-size: 3.5rem;
                height: 80px;
            }
            
            .winner-container {
                padding: 20px;
            }
            
            .winner-container h1 {
                font-size: 1.8rem;
            }
            
            .winner-name {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Page 1: Card Selection -->
    <div id="page1" class="page active">
        <div class="container">
            <div class="header">
                <h1><i class="fas fa-dice"></i> Bingo Game</h1>
                <p>Choose up to 2 bingo cards. You have 1 minute to make your selection!</p>
            </div>
            
            <div class="countdown-timer">
                <div class="timer-text">Time Remaining:</div>
                <div id="timerDisplay" class="timer-display">01:00</div>
            </div>
            
            <div class="selection-info">
                <h3>Your Selected Cards</h3>
                <p>Click on card numbers below to select/deselect (max 2)</p>
                <div class="selected-cards">
                    <div id="selectedCard1" class="selected-card" style="display: none;"></div>
                    <div id="selectedCard2" class="selected-card" style="display: none;"></div>
                </div>
            </div>
            
            <div class="cards-grid" id="cardsGrid">
                <!-- Card numbers will be generated by JavaScript -->
            </div>
            
            <div class="action-buttons">
                <button id="proceedBtn" class="btn btn-primary" disabled>
                    <i class="fas fa-play-circle"></i> Start Game
                </button>
                <button id="resetSelectionBtn" class="btn btn-secondary">
                    <i class="fas fa-redo"></i> Reset Selection
                </button>
            </div>
        </div>
    </div>
    
    <!-- Page 2: Game Page -->
    <div id="page2" class="page">
        <div class="container">
            <div class="game-header">
                <div class="player-info">
                    <h3>Player</h3>
                    <div class="player-username" id="playerUsername">@telegram_user</div>
                    <div id="playerCardsInfo">Cards: <span id="playerCardsCount">0</span></div>
                </div>
                
                <div class="player-info">
                    <h3>Game Status</h3>
                    <div>Numbers Called: <span id="numbersCalledCount">0</span></div>
                    <div>Time Elapsed: <span id="gameTime">00:00</span></div>
                </div>
            </div>
            
            <div class="caller-display">
                <h2><i class="fas fa-bullhorn"></i> Current Number</h2>
                <div id="currentNumber" class="current-number">--</div>
                <div id="callerMessage">Next number in: <span id="nextCallCountdown">5</span>s</div>
            </div>
            
            <div class="called-numbers-container">
                <h3><i class="fas fa-list-ol"></i> Called Numbers</h3>
                <div id="calledNumbers" class="called-numbers">
                    <!-- Called numbers will appear here -->
                </div>
            </div>
            
            <div class="player-cards-container" id="playerCardsContainer">
                <!-- Player's bingo cards will be generated here -->
            </div>
            
            <div class="bingo-button-container">
                <button id="bingoBtn" class="btn-bingo" disabled>
                    <i class="fas fa-trophy"></i> BINGO!
                </button>
                <p id="bingoStatus">Complete a line (horizontal, vertical, or diagonal) to claim Bingo!</p>
            </div>
        </div>
    </div>
    
    <!-- Page 3: Winner Announcement -->
    <div id="page3" class="page">
        <div class="container">
            <div class="winner-container">
                <div class="winner-trophy">
                    <i class="fas fa-trophy"></i>
                </div>
                <h1>BINGO WINNER!</h1>
                <div class="winner-name" id="winnerName">@telegram_user</div>
                <p style="font-size: 1.3rem; margin-bottom: 30px;">Congratulations! You completed a Bingo line!</p>
                
                <div class="winner-card">
                    <h3>Winner Details</h3>
                    <div class="winner-card-info">
                        <div class="winner-card-item">
                            <p>Username: <span id="winnerUsername">@telegram_user</span></p>
                            <p>Winning Card: <span id="winningCardNumber">1</span></p>
                        </div>
                        <div class="winner-card-item">
                            <p>Numbers Called: <span id="winnerNumbersCalled">0</span></p>
                            <p>Time to Win: <span id="winnerTime">00:00</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons-page3">
                    <button id="playAgainBtn" class="btn btn-primary">
                        <i class="fas fa-redo"></i> Play Again
                    </button>
                    <button id="newGameBtn" class="btn btn-secondary">
                        <i class="fas fa-home"></i> Back to Selection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            // Card selection
            totalCards: 500,
            selectedCards: [],
            selectionTimeLimit: 60, // 1 minute in seconds
            
            // Game
            bingoCards: [],
            calledNumbers: [],
            currentNumber: null,
            gameStartTime: null,
            gameTimerInterval: null,
            callerInterval: null,
            callerSpeed: 5000, // 5 seconds
            nextCallCountdown: 5,
            countdownInterval: null,
            
            // Player
            playerUsername: "@telegram_user",
            
            // Winner
            winner: null,
            winningPattern: null
        };

        // DOM Elements
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const page3 = document.getElementById('page3');
        const timerDisplay = document.getElementById('timerDisplay');
        const cardsGrid = document.getElementById('cardsGrid');
        const selectedCard1 = document.getElementById('selectedCard1');
        const selectedCard2 = document.getElementById('selectedCard2');
        const proceedBtn = document.getElementById('proceedBtn');
        const resetSelectionBtn = document.getElementById('resetSelectionBtn');
        const playerUsername = document.getElementById('playerUsername');
        const playerCardsCount = document.getElementById('playerCardsCount');
        const numbersCalledCount = document.getElementById('numbersCalledCount');
        const gameTime = document.getElementById('gameTime');
        const currentNumberDisplay = document.getElementById('currentNumber');
        const nextCallCountdown = document.getElementById('nextCallCountdown');
        const calledNumbersContainer = document.getElementById('calledNumbers');
        const playerCardsContainer = document.getElementById('playerCardsContainer');
        const bingoBtn = document.getElementById('bingoBtn');
        const bingoStatus = document.getElementById('bingoStatus');
        const winnerName = document.getElementById('winnerName');
        const winnerUsername = document.getElementById('winnerUsername');
        const winningCardNumber = document.getElementById('winningCardNumber');
        const winnerNumbersCalled = document.getElementById('winnerNumbersCalled');
        const winnerTime = document.getElementById('winnerTime');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const newGameBtn = document.getElementById('newGameBtn');

        // Initialize the game
        function initGame() {
            // Generate card selection grid
            generateCardGrid();
            
            // Start selection countdown
            startSelectionCountdown();
            
            // Set player username (in a real Telegram Mini App, this would come from Telegram)
            playerUsername.textContent = gameState.playerUsername;
            
            // Generate bingo cards (500 unique cards)
            generateBingoCards();
            
            // Set up event listeners
            setupEventListeners();
        }

        // Generate the grid of card numbers (1-500)
        function generateCardGrid() {
            cardsGrid.innerHTML = '';
            
            for (let i = 1; i <= gameState.totalCards; i++) {
                const cardElement = document.createElement('div');
                cardElement.className = 'card-number';
                cardElement.textContent = i;
                cardElement.dataset.cardNumber = i;
                
                cardElement.addEventListener('click', () => toggleCardSelection(i));
                
                cardsGrid.appendChild(cardElement);
            }
        }

        // Toggle card selection
        function toggleCardSelection(cardNumber) {
            const cardElement = document.querySelector(`[data-card-number="${cardNumber}"]`);
            const index = gameState.selectedCards.indexOf(cardNumber);
            
            if (index === -1) {
                // Select card if we have less than 2 selected
                if (gameState.selectedCards.length < 2) {
                    gameState.selectedCards.push(cardNumber);
                    cardElement.classList.add('selected');
                    
                    // Update selected cards display
                    updateSelectedCardsDisplay();
                    
                    // Enable proceed button if we have at least 1 card
                    if (gameState.selectedCards.length >= 1) {
                        proceedBtn.disabled = false;
                    }
                }
            } else {
                // Deselect card
                gameState.selectedCards.splice(index, 1);
                cardElement.classList.remove('selected');
                
                // Update selected cards display
                updateSelectedCardsDisplay();
                
                // Disable proceed button if no cards selected
                if (gameState.selectedCards.length === 0) {
                    proceedBtn.disabled = true;
                }
            }
        }

        // Update the display of selected cards
        function updateSelectedCardsDisplay() {
            // Show/hide selected card displays
            if (gameState.selectedCards.length >= 1) {
                selectedCard1.style.display = 'flex';
                selectedCard1.textContent = gameState.selectedCards[0];
            } else {
                selectedCard1.style.display = 'none';
            }
            
            if (gameState.selectedCards.length >= 2) {
                selectedCard2.style.display = 'flex';
                selectedCard2.textContent = gameState.selectedCards[1];
            } else {
                selectedCard2.style.display = 'none';
            }
            
            // Update player cards count
            playerCardsCount.textContent = gameState.selectedCards.length;
        }

        // Start the 1-minute selection countdown
        function startSelectionCountdown() {
            let timeLeft = gameState.selectionTimeLimit;
            
            const countdown = setInterval(() => {
                timeLeft--;
                
                // Update timer display
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Change color when time is running out
                if (timeLeft <= 10) {
                    timerDisplay.style.color = '#ff4081';
                    timerDisplay.style.animation = 'pulse 1s infinite';
                }
                
                // When time is up, proceed automatically if cards are selected
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    timerDisplay.textContent = "00:00";
                    
                    // Auto-proceed if at least one card is selected
                    if (gameState.selectedCards.length > 0) {
                        proceedToGame();
                    } else {
                        // If no cards selected, select random cards for the player
                        selectRandomCards();
                        proceedToGame();
                    }
                }
            }, 1000);
        }

        // Select random cards for the player (if they don't select any)
        function selectRandomCards() {
            // Clear any existing selections
            gameState.selectedCards = [];
            document.querySelectorAll('.card-number.selected').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select 2 random cards
            for (let i = 0; i < 2; i++) {
                let randomCard;
                do {
                    randomCard = Math.floor(Math.random() * gameState.totalCards) + 1;
                } while (gameState.selectedCards.includes(randomCard));
                
                gameState.selectedCards.push(randomCard);
                document.querySelector(`[data-card-number="${randomCard}"]`).classList.add('selected');
            }
            
            // Update display
            updateSelectedCardsDisplay();
        }

        // Generate 500 unique bingo cards
        function generateBingoCards() {
            // Standard Bingo column ranges
            const columnRanges = [
                { letter: 'B', min: 1, max: 15 },
                { letter: 'I', min: 16, max: 30 },
                { letter: 'N', min: 31, max: 45 },
                { letter: 'G', min: 46, max: 60 },
                { letter: 'O', min: 61, max: 75 }
            ];
            
            // Generate 500 unique cards
            for (let cardNum = 1; cardNum <= 500; cardNum++) {
                const card = {
                    id: cardNum,
                    numbers: [],
                    marked: Array(5).fill().map(() => Array(5).fill(false))
                };
                
                // Mark the center as FREE (already marked)
                card.marked[2][2] = true;
                
                // Generate numbers for each column
                for (let col = 0; col < 5; col++) {
                    const range = columnRanges[col];
                    const numbersInColumn = [];
                    
                    // Create a pool of numbers for this column
                    const pool = [];
                    for (let i = range.min; i <= range.max; i++) {
                        pool.push(i);
                    }
                    
                    // Shuffle the pool
                    shuffleArray(pool);
                    
                    // Take first 5 numbers (except for column N which takes 4 because of FREE space)
                    const count = col === 2 ? 4 : 5;
                    const selectedNumbers = pool.slice(0, count);
                    
                    // Sort numbers for display
                    selectedNumbers.sort((a, b) => a - b);
                    
                    // Insert numbers into card
                    for (let row = 0; row < 5; row++) {
                        if (!card.numbers[row]) card.numbers[row] = [];
                        
                        if (col === 2 && row === 2) {
                            // Center is FREE
                            card.numbers[row][col] = 'FREE';
                        } else if (col === 2 && row > 2) {
                            // For column N, adjust for FREE space
                            card.numbers[row][col] = selectedNumbers[row - 1];
                        } else {
                            card.numbers[row][col] = selectedNumbers[row];
                        }
                    }
                }
                
                gameState.bingoCards.push(card);
            }
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Proceed to the game page
        function proceedToGame() {
            // Switch to page 2
            page1.classList.remove('active');
            page2.classList.add('active');
            
            // Display player's selected bingo cards
            displayPlayerCards();
            
            // Start the game
            startGame();
        }

        // Display the player's selected bingo cards
        function displayPlayerCards() {
            playerCardsContainer.innerHTML = '';
            
            if (gameState.selectedCards.length === 0) {
                playerCardsContainer.innerHTML = '<p>No cards selected.</p>';
                return;
            }
            
            // Create a card display for each selected card
            gameState.selectedCards.forEach((cardId, index) => {
                const cardData = gameState.bingoCards.find(card => card.id === cardId);
                
                const cardContainer = document.createElement('div');
                cardContainer.className = 'card-container';
                cardContainer.dataset.cardId = cardId;
                
                const cardTitle = document.createElement('h3');
                cardTitle.textContent = `Bingo Card #${cardId}`;
                cardContainer.appendChild(cardTitle);
                
                // Create the bingo card table
                const table = document.createElement('table');
                table.className = 'bingo-card';
                
                // Create header row with B-I-N-G-O
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                
                ['B', 'I', 'N', 'G', 'O'].forEach(letter => {
                    const th = document.createElement('th');
                    th.textContent = letter;
                    headerRow.appendChild(th);
                });
                
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // Create table body with numbers
                const tbody = document.createElement('tbody');
                
                for (let row = 0; row < 5; row++) {
                    const tr = document.createElement('tr');
                    
                    for (let col = 0; col < 5; col++) {
                        const td = document.createElement('td');
                        td.textContent = cardData.numbers[row][col];
                        td.dataset.row = row;
                        td.dataset.col = col;
                        
                        // Mark center as FREE
                        if (row === 2 && col === 2) {
                            td.classList.add('free');
                            td.textContent = 'FREE';
                        }
                        
                        // Add click handler to mark numbers manually
                        td.addEventListener('click', () => markNumber(cardId, row, col));
                        
                        tr.appendChild(td);
                    }
                    
                    tbody.appendChild(tr);
                }
                
                table.appendChild(tbody);
                cardContainer.appendChild(table);
                playerCardsContainer.appendChild(cardContainer);
            });
        }

        // Start the game
        function startGame() {
            // Reset game state
            gameState.calledNumbers = [];
            gameState.currentNumber = null;
            gameState.gameStartTime = new Date();
            gameState.nextCallCountdown = 5;
            
            // Update displays
            updateCalledNumbersDisplay();
            numbersCalledCount.textContent = '0';
            currentNumberDisplay.textContent = '--';
            nextCallCountdown.textContent = '5';
            
            // Start game timer
            if (gameState.gameTimerInterval) clearInterval(gameState.gameTimerInterval);
            gameState.gameTimerInterval = setInterval(updateGameTimer, 1000);
            
            // Start the countdown to first number
            if (gameState.countdownInterval) clearInterval(gameState.countdownInterval);
            gameState.countdownInterval = setInterval(updateCallerCountdown, 1000);
            
            // Call the first number after 5 seconds
            setTimeout(callNextNumber, 5000);
        }

        // Update the game timer
        function updateGameTimer() {
            const now = new Date();
            const elapsedSeconds = Math.floor((now - gameState.gameStartTime) / 1000);
            
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            
            gameTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update the caller countdown
        function updateCallerCountdown() {
            gameState.nextCallCountdown--;
            nextCallCountdown.textContent = gameState.nextCallCountdown;
            
            if (gameState.nextCallCountdown <= 0) {
                gameState.nextCallCountdown = 5;
            }
        }

        // Call the next bingo number
        function callNextNumber() {
            // If 75 numbers have been called, end the game
            if (gameState.calledNumbers.length >= 75) {
                endGame();
                return;
            }
            
            // Generate a random number that hasn't been called yet
            let nextNumber;
            do {
                nextNumber = Math.floor(Math.random() * 75) + 1;
            } while (gameState.calledNumbers.includes(nextNumber));
            
            // Add to called numbers
            gameState.calledNumbers.push(nextNumber);
            gameState.currentNumber = nextNumber;
            
            // Update displays
            currentNumberDisplay.textContent = nextNumber;
            numbersCalledCount.textContent = gameState.calledNumbers.length;
            updateCalledNumbersDisplay();
            
            // Mark this number on all player cards
            markNumberOnAllCards(nextNumber);
            
            // Check for bingo
            checkForBingo();
            
            // Schedule next number call
            if (gameState.callerInterval) clearInterval(gameState.callerInterval);
            gameState.callerInterval = setTimeout(callNextNumber, gameState.callerSpeed);
            
            // Reset countdown
            gameState.nextCallCountdown = 5;
        }

        // Update the called numbers display
        function updateCalledNumbersDisplay() {
            calledNumbersContainer.innerHTML = '';
            
            gameState.calledNumbers.forEach(number => {
                const numberElement = document.createElement('div');
                numberElement.className = 'called-number';
                numberElement.textContent = number;
                calledNumbersContainer.appendChild(numberElement);
            });
            
            // Scroll to the end
            calledNumbersContainer.scrollLeft = calledNumbersContainer.scrollWidth;
        }

        // Mark a number on all player cards
        function markNumberOnAllCards(number) {
            gameState.selectedCards.forEach(cardId => {
                const cardData = gameState.bingoCards.find(card => card.id === cardId);
                
                for (let row = 0; row < 5; row++) {
                    for (let col = 0; col < 5; col++) {
                        if (cardData.numbers[row][col] === number) {
                            cardData.marked[row][col] = true;
                            
                            // Update the visual display
                            const td = document.querySelector(`[data-card-id="${cardId}"] [data-row="${row}"][data-col="${col}"]`);
                            if (td) td.classList.add('marked');
                        }
                    }
                }
            });
        }

        // Mark a number manually (when player clicks on a cell)
        function markNumber(cardId, row, col) {
            // Don't allow marking the FREE space
            if (row === 2 && col === 2) return;
            
            const cardData = gameState.bingoCards.find(card => card.id === cardId);
            cardData.marked[row][col] = !cardData.marked[row][col];
            
            // Update the visual display
            const td = document.querySelector(`[data-card-id="${cardId}"] [data-row="${row}"][data-col="${col}"]`);
            if (td) td.classList.toggle('marked');
            
            // Check for bingo
            checkForBingo();
        }

        // Check if any bingo card has a winning pattern
        function checkForBingo() {
            let hasBingo = false;
            let winningCardId = null;
            let winningPattern = null;
            
            // Check each selected card
            for (const cardId of gameState.selectedCards) {
                const cardData = gameState.bingoCards.find(card => card.id === cardId);
                
                // Check rows
                for (let row = 0; row < 5; row++) {
                    if (cardData.marked[row].every(cell => cell === true)) {
                        hasBingo = true;
                        winningCardId = cardId;
                        winningPattern = `Row ${row + 1}`;
                        break;
                    }
                }
                
                if (hasBingo) break;
                
                // Check columns
                for (let col = 0; col < 5; col++) {
                    let columnComplete = true;
                    for (let row = 0; row < 5; row++) {
                        if (!cardData.marked[row][col]) {
                            columnComplete = false;
                            break;
                        }
                    }
                    
                    if (columnComplete) {
                        hasBingo = true;
                        winningCardId = cardId;
                        winningPattern = `Column ${col === 0 ? 'B' : col === 1 ? 'I' : col === 2 ? 'N' : col === 3 ? 'G' : 'O'}`;
                        break;
                    }
                }
                
                if (hasBingo) break;
                
                // Check diagonals
                let diag1Complete = true;
                let diag2Complete = true;
                
                for (let i = 0; i < 5; i++) {
                    if (!cardData.marked[i][i]) diag1Complete = false;
                    if (!cardData.marked[i][4 - i]) diag2Complete = false;
                }
                
                if (diag1Complete || diag2Complete) {
                    hasBingo = true;
                    winningCardId = cardId;
                    winningPattern = diag1Complete ? 'Diagonal (top-left to bottom-right)' : 'Diagonal (top-right to bottom-left)';
                    break;
                }
            }
            
            // Update bingo button
            if (hasBingo) {
                bingoBtn.disabled = false;
                bingoStatus.textContent = `Bingo available! ${winningPattern} completed on Card #${winningCardId}`;
                bingoStatus.style.color = '#4caf50';
                
                // Store winning information
                gameState.winner = gameState.playerUsername;
                gameState.winningCardId = winningCardId;
                gameState.winningPattern = winningPattern;
            } else {
                bingoBtn.disabled = true;
                bingoStatus.textContent = 'Complete a line (horizontal, vertical, or diagonal) to claim Bingo!';
                bingoStatus.style.color = 'white';
            }
            
            return hasBingo;
        }

        // Claim bingo
        function claimBingo() {
            if (!checkForBingo()) {
                alert("You don't have a complete bingo line yet!");
                return;
            }
            
            // Stop the game
            endGame();
            
            // Switch to winner announcement page
            page2.classList.remove('active');
            page3.classList.add('active');
            
            // Update winner information
            winnerName.textContent = gameState.playerUsername;
            winnerUsername.textContent = gameState.playerUsername;
            winningCardNumber.textContent = gameState.winningCardId;
            winnerNumbersCalled.textContent = gameState.calledNumbers.length;
            winnerTime.textContent = gameTime.textContent;
        }

        // End the game
        function endGame() {
            // Stop all intervals
            if (gameState.callerInterval) clearTimeout(gameState.callerInterval);
            if (gameState.countdownInterval) clearInterval(gameState.countdownInterval);
            if (gameState.gameTimerInterval) clearInterval(gameState.gameTimerInterval);
            
            // Disable bingo button
            bingoBtn.disabled = true;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Card selection page
            proceedBtn.addEventListener('click', proceedToGame);
            resetSelectionBtn.addEventListener('click', resetSelection);
            
            // Game page
            bingoBtn.addEventListener('click', claimBingo);
            
            // Winner page
            playAgainBtn.addEventListener('click', playAgain);
            newGameBtn.addEventListener('click', newGame);
        }

        // Reset card selection
        function resetSelection() {
            // Clear selected cards
            gameState.selectedCards.forEach(cardNumber => {
                const cardElement = document.querySelector(`[data-card-number="${cardNumber}"]`);
                if (cardElement) cardElement.classList.remove('selected');
            });
            
            gameState.selectedCards = [];
            
            // Update display
            updateSelectedCardsDisplay();
            
            // Disable proceed button
            proceedBtn.disabled = true;
        }

        // Play again (with same cards)
        function playAgain() {
            // Switch back to game page
            page3.classList.remove('active');
            page2.classList.add('active');
            
            // Reset and start a new game with the same cards
            startGame();
        }

        // Start a new game (go back to card selection)
        function newGame() {
            // Reset selection
            resetSelection();
            
            // Switch back to card selection page
            page3.classList.remove('active');
            page1.classList.add('active');
            
            // Reset timer
            timerDisplay.textContent = "01:00";
            timerDisplay.style.color = '#ff4081';
            timerDisplay.style.animation = 'none';
            
            // Restart selection countdown
            startSelectionCountdown();
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>