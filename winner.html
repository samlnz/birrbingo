<!-- winner.html - Auto-redirect after 5 seconds -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Winner!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/animations.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .winner-page-mobile {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            text-align: center;
        }
        
        .winner-card {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 25px;
            border: 4px solid var(--accent);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
            max-width: 400px;
            width: 100%;
            animation: scaleIn 0.5s ease;
        }
        
        .trophy-icon {
            font-size: 4rem;
            color: var(--accent);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .winner-title {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .winner-subtitle {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        .winner-details {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .winner-name {
            font-size: 1.8rem;
            color: white;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .winner-telegram {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }
        
        .prize-amount {
            font-size: 3.5rem;
            color: var(--accent);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .prize-label {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .countdown-timer {
            font-size: 1.2rem;
            color: var(--primary);
            margin-top: 25px;
            font-family: 'Courier New', monospace;
        }
        
        .next-game-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .next-game-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        
        .next-game-timer {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @media (max-width: 480px) {
            .winner-card {
                padding: 20px;
                border-radius: 15px;
            }
            
            .winner-title {
                font-size: 1.6rem;
            }
            
            .prize-amount {
                font-size: 2.8rem;
            }
            
            .winner-name {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body class="winner-page-mobile">
    <div class="winner-card">
        <div class="trophy-icon">
            <i class="fas fa-trophy"></i>
        </div>
        
        <h1 class="winner-title">BINGO WINNER!</h1>
        
        <p class="winner-subtitle">
            Congratulations on completing a winning line!
        </p>
        
        <div class="winner-details">
            <div class="winner-name" id="winnerNameDisplay">Telegram User</div>
            <div class="winner-telegram" id="winnerTelegramDisplay">@username</div>
            
            <div class="prize-amount" id="prizeAmountDisplay">0 BIRR</div>
            <div class="prize-label">Prize Won</div>
        </div>
        
        <div class="next-game-info">
            <div class="next-game-label">Next game starts in</div>
            <div class="next-game-timer" id="nextGameTimer">5</div>
        </div>
        
        <div class="countdown-timer" id="redirectTimer">
            Redirecting in <span id="countdown">5</span> seconds...
        </div>
    </div>
    
    <!-- Confetti Effect -->
    <div id="confetti"></div>
    
    <!-- Audio -->
    <audio id="winnerAudio" autoplay>
        <source src="audio/winner.mp3" type="audio/mpeg">
    </audio>

    <script src="js/game-state.js"></script>
    <script src="js/telegram-api.js"></script>
    <script>
        // Initialize Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // Get winner data from URL
        const urlParams = new URLSearchParams(window.location.search);
        const winnerId = urlParams.get('winner');
        const prizeAmount = urlParams.get('prize') || '0';
        
        // DOM elements
        const winnerNameDisplay = document.getElementById('winnerNameDisplay');
        const winnerTelegramDisplay = document.getElementById('winnerTelegramDisplay');
        const prizeAmountDisplay = document.getElementById('prizeAmountDisplay');
        const countdownElement = document.getElementById('countdown');
        const nextGameTimer = document.getElementById('nextGameTimer');
        
        // Countdown variables
        let countdown = 5;
        let nextGameCountdown = 60; // Next game starts in 1 minute
        
        // Initialize
        function init() {
            // Load winner data
            loadWinnerData();
            
            // Start countdown
            startCountdown();
            
            // Start next game countdown
            startNextGameCountdown();
            
            // Create confetti
            createConfetti();
        }
        
        function loadWinnerData() {
            // Get current player info
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                const playerName = user.first_name || 'Player';
                const fullName = user.last_name ? `${playerName} ${user.last_name}` : playerName;
                
                winnerNameDisplay.textContent = fullName;
                winnerTelegramDisplay.textContent = `@${user.username || playerName.toLowerCase()}`;
            }
            
            // Display prize
            prizeAmountDisplay.textContent = `${prizeAmount} BIRR`;
            
            // Calculate house profit (20%)
            const totalStakes = (parseInt(prizeAmount) / 0.8);
            const houseProfit = totalStakes * 0.2;
            
            console.log(`House profit: ${houseProfit.toFixed(2)} BIRR`);
        }
        
        function startCountdown() {
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    redirectToCardSelection();
                }
            }, 1000);
        }
        
        function startNextGameCountdown() {
            const gameData = JSON.parse(localStorage.getItem('bingoGameState') || '{}');
            nextGameCountdown = gameData.gameTimer || 60;
            
            nextGameTimer.textContent = nextGameCountdown;
            
            const countdownInterval = setInterval(() => {
                nextGameCountdown--;
                nextGameTimer.textContent = nextGameCountdown;
                
                if (nextGameCountdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }
        
        function redirectToCardSelection() {
            // Reset game for next round
            resetGameForNextRound();
            
            // Redirect to card selection
            window.location.href = 'choose-cards.html';
        }
        
        function resetGameForNextRound() {
            // Reset player's selected cards
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const userId = tg.initDataUnsafe.user.id.toString();
                const players = JSON.parse(localStorage.getItem('bingoPlayers') || '[]');
                const playerIndex = players.findIndex(p => p.id === userId);
                
                if (playerIndex > -1) {
                    players[playerIndex].selectedCards = [];
                    localStorage.setItem('bingoPlayers', JSON.stringify(players));
                }
            }
            
            // Reset game state
            const gameData = JSON.parse(localStorage.getItem('bingoGameState') || '{}');
            gameData.calledNumbers = [];
            gameData.lastUpdated = Date.now();
            localStorage.setItem('bingoGameState', JSON.stringify(gameData));
        }
        
        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 15 + 10}px`;
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '-20px';
                confetti.style.opacity = Math.random() * 0.5 + 0.5;
                confetti.style.zIndex = '9999';
                confetti.style.pointerEvents = 'none';
                
                const animationDuration = Math.random() * 3 + 2;
                const animationDelay = Math.random() * 5;
                
                confetti.style.animation = `
                    confettiFall ${animationDuration}s ease-in ${animationDelay}s forwards
                `;
                
                confettiContainer.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => {
                    confetti.remove();
                }, (animationDuration + animationDelay) * 1000);
            }
        }
        
        // Add confetti animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes confettiFall {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>